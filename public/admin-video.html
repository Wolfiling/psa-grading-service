<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion Preuves Vid√©o - PSA Admin</title>
    <link rel="icon" type="image/png" href="/shopify-psa-logo.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f6f6f7;
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #003366, #0066cc);
            color: white;
            padding: 1.5rem 2rem;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1600px;
            margin: 0 auto;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        .btn-primary {
            background: #28a745;
            border-color: #28a745;
        }

        .btn-primary:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            border-color: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* DASHBOARD STATISTICS */
        .stats-section {
            margin-bottom: 3rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 2rem 1.5rem;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border-left: 5px solid #003366;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }

        .stat-card.warning {
            border-left-color: #ffa500;
        }

        .stat-card.success {
            border-left-color: #28a745;
        }

        .stat-card.danger {
            border-left-color: #dc3545;
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stat-icon {
            font-size: 2rem;
            opacity: 0.7;
        }

        .stat-number {
            font-size: 2.8rem;
            font-weight: 800;
            color: #003366;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .stat-trend {
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        .trend-up {
            color: #28a745;
        }

        .trend-down {
            color: #dc3545;
        }

        /* ALERTS SECTION */
        .alerts-section {
            margin-bottom: 2rem;
        }

        .alert {
            padding: 1rem 1.5rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        /* MAIN CONTENT SECTIONS */
        .content-section {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .section-header {
            padding: 2rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8fafc;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #003366;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* FILTERS */
        .filters-section {
            padding: 1.5rem 2rem;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-label {
            font-weight: 600;
            font-size: 0.875rem;
            color: #374151;
        }

        .filter-input,
        .filter-select {
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.875rem;
            transition: border-color 0.3s ease;
        }

        .filter-input:focus,
        .filter-select:focus {
            outline: none;
            border-color: #003366;
            box-shadow: 0 0 0 3px rgba(0,51,102,0.1);
        }

        .filters-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            align-items: center;
        }

        /* TABLE */
        .table-container {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: #f8fafc;
            padding: 1.25rem 1rem;
            text-align: left;
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            border-bottom: 2px solid #e5e7eb;
        }

        .table td {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            vertical-align: middle;
        }

        .table tbody tr {
            transition: background-color 0.2s ease;
        }

        .table tbody tr:hover {
            background: #f8fafc;
        }

        /* STATUS BADGES */
        .badge {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .badge-uploaded {
            background: #d4edda;
            color: #155724;
        }

        .badge-pending {
            background: #fff3cd;
            color: #856404;
        }

        .badge-missing {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-error {
            background: #f5c6cb;
            color: #721c24;
        }

        /* ACTION BUTTONS */
        .actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            border-radius: 6px;
        }

        .btn-icon {
            width: 2rem;
            height: 2rem;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 16px;
            width: 95%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 2rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8fafc;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #003366;
        }

        .close {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #6b7280;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #dc3545;
        }

        .modal-body {
            padding: 2rem;
        }

        /* VIDEO PLAYER */
        .video-container {
            margin: 1rem 0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .video-player {
            width: 100%;
            height: 400px;
            background: #000;
        }

        .video-info {
            background: #f8fafc;
            padding: 1rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .video-meta {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .video-meta-label {
            font-size: 0.75rem;
            color: #6b7280;
            text-transform: uppercase;
            font-weight: 600;
        }

        .video-meta-value {
            font-weight: 500;
        }

        /* LOADING STATES */
        .loading {
            text-align: center;
            padding: 3rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #e5e7eb;
            border-top: 3px solid #003366;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* EMPTY STATES */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #6b7280;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            margin-bottom: 0.5rem;
            color: #374151;
        }

        /* PAGINATION */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            padding: 2rem;
        }

        .pagination button {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination button:hover {
            background: #f3f4f6;
        }

        .pagination button.active {
            background: #003366;
            color: white;
            border-color: #003366;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .filters-actions {
                justify-content: center;
            }

            .section-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .actions {
                justify-content: center;
            }

            .modal-content {
                width: 98%;
                margin: 1% auto;
                max-height: 98vh;
            }
        }

        /* UTILITY CLASSES */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .hidden { display: none; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .p-0 { padding: 0; }
        .p-1 { padding: 0.5rem; }
        .p-2 { padding: 1rem; }

        /* CHARTS CONTAINER */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .chart-container {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .chart-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: #374151;
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <div class="header">
        <div class="header-content">
            <h1>
                üé• Gestion Preuves Vid√©o PSA
            </h1>
            <div class="header-actions">
                <a href="/admin" class="btn">
                    üìä Dashboard Principal
                </a>
                <button class="btn btn-primary" onclick="refreshAllData()">
                    üîÑ Actualiser
                </button>
                <button class="btn" onclick="showCleanupModal()">
                    üßπ Maintenance
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- STATISTICS DASHBOARD -->
        <div class="stats-section">
            <div class="stats-grid" id="statsGrid">
                <!-- Dynamic stats loaded here -->
            </div>
        </div>

        <!-- CRITICAL ALERTS -->
        <div class="alerts-section" id="alertsSection">
            <!-- Dynamic alerts loaded here -->
        </div>

        <!-- FILTERS & SEARCH -->
        <div class="content-section">
            <div class="section-header">
                <h2 class="section-title">
                    üìã Gestion des Soumissions
                </h2>
                <div style="display: flex; gap: 1rem;">
                    <button class="btn btn-primary" onclick="exportToCSV()">
                        üì• Export CSV
                    </button>
                    <button class="btn" onclick="showSystemStatus()">
                        ‚öôÔ∏è √âtat Syst√®me
                    </button>
                </div>
            </div>

            <div class="filters-section">
                <div class="filters-grid">
                    <div class="filter-group">
                        <label class="filter-label">Recherche</label>
                        <input type="text" id="searchInput" class="filter-input" 
                               placeholder="ID soumission, email, carte..." 
                               onkeyup="debounceFilter()">
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Statut Vid√©o</label>
                        <select id="videoStatusFilter" class="filter-select" onchange="applyFilters()">
                            <option value="">Tous les statuts</option>
                            <option value="uploaded">‚úÖ Vid√©o pr√©sente</option>
                            <option value="pending">‚è≥ En attente</option>
                            <option value="missing">‚ùå Manquante</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Type Gradation</label>
                        <select id="gradingTypeFilter" class="filter-select" onchange="applyFilters()">
                            <option value="">Tous les types</option>
                            <option value="value">PSA Value</option>
                            <option value="regular">PSA Regular</option>
                            <option value="express">PSA Express</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Date de</label>
                        <input type="date" id="dateFromFilter" class="filter-input" onchange="applyFilters()">
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Date √†</label>
                        <input type="date" id="dateToFilter" class="filter-input" onchange="applyFilters()">
                    </div>
                </div>

                <div class="filters-actions">
                    <span id="resultsCount" class="filter-label">-</span>
                    <button class="btn btn-small" onclick="clearAllFilters()">
                        üóëÔ∏è Effacer filtres
                    </button>
                </div>
            </div>

            <!-- LOADING STATE -->
            <div id="loadingState" class="loading">
                <div class="spinner"></div>
                <p>Chargement des soumissions...</p>
            </div>

            <!-- TABLE -->
            <div id="tableContainer" class="table-container" style="display: none;">
                <table class="table">
                    <thead>
                        <tr>
                            <th>
                                <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                            </th>
                            <th>ID Soumission</th>
                            <th>Client</th>
                            <th>Carte</th>
                            <th>Type PSA</th>
                            <th>Statut Vid√©o</th>
                            <th>Taille</th>
                            <th>Date Cr√©ation</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="submissionsTable">
                        <!-- Dynamic content loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- PAGINATION -->
            <div id="paginationContainer" class="pagination" style="display: none;">
                <!-- Dynamic pagination loaded here -->
            </div>

            <!-- EMPTY STATE -->
            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="empty-state-icon">üé•</div>
                <h3>Aucune soumission trouv√©e</h3>
                <p>Aucune soumission ne correspond aux crit√®res de recherche.</p>
            </div>
        </div>
    </div>

    <!-- SUBMISSION DETAILS MODAL -->
    <div id="submissionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üìã D√©tails de la Soumission</h3>
                <button class="close" onclick="closeSubmissionModal()">&times;</button>
            </div>
            <div class="modal-body" id="submissionModalBody">
                <!-- Dynamic content loaded here -->
            </div>
        </div>
    </div>

    <!-- CLEANUP MODAL -->
    <div id="cleanupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üßπ Maintenance Syst√®me</h3>
                <button class="close" onclick="closeCleanupModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <h4>Options de nettoyage</h4>
                    <p class="text-muted">S√©lectionnez les op√©rations de maintenance √† effectuer :</p>
                </div>

                <div class="form-check mb-2">
                    <input type="checkbox" id="cleanOrphans" checked>
                    <label for="cleanOrphans">üóÇÔ∏è Supprimer les fichiers orphelins (sans entr√©e DB)</label>
                </div>

                <div class="form-check mb-2">
                    <input type="checkbox" id="cleanOldFiles">
                    <label for="cleanOldFiles">üì¶ Archiver les anciens fichiers (>180 jours)</label>
                </div>

                <div class="form-group mb-3">
                    <label class="filter-label">Seuil d'anciennet√© (jours)</label>
                    <input type="number" id="daysThreshold" class="filter-input" value="180" min="30" max="365">
                </div>

                <div class="form-check mb-3">
                    <input type="checkbox" id="dryRun" checked>
                    <label for="dryRun">üîç Simulation seulement (ne pas supprimer)</label>
                </div>

                <div class="text-center">
                    <button class="btn btn-primary" onclick="runCleanup()">
                        üßπ Lancer la maintenance
                    </button>
                </div>

                <div id="cleanupResults" class="mt-3" style="display: none;">
                    <!-- Results will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <!-- SYSTEM STATUS MODAL -->
    <div id="systemStatusModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚öôÔ∏è √âtat du Syst√®me Vid√©o</h3>
                <button class="close" onclick="closeSystemStatusModal()">&times;</button>
            </div>
            <div class="modal-body" id="systemStatusBody">
                <!-- Dynamic content loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentSubmissions = [];
        let currentPage = 1;
        let totalPages = 1;
        let currentFilters = {};
        let debounceTimer = null;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeAdminVideoInterface();
        });

        /**
         * Initialize the complete admin video interface
         */
        async function initializeAdminVideoInterface() {
            console.log('üé• Initializing PSA Video Admin Interface...');
            
            try {
                // Load all data in parallel for better performance
                await Promise.all([
                    loadVideoStats(),
                    loadSubmissions()
                ]);
                
                console.log('‚úÖ Admin Video Interface initialized successfully');
            } catch (error) {
                console.error('‚ùå Error initializing admin interface:', error);
                showErrorAlert('Erreur lors de l\'initialisation de l\'interface');
            }
        }

        /**
         * Load video statistics and display them
         */
        async function loadVideoStats() {
            try {
                const response = await fetch('/admin/api/video-stats', {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    displayVideoStats(data.stats);
                    
                    // Show alerts if there are critical issues
                    if (data.stats.critical_alerts > 0) {
                        showCriticalAlerts(data.stats);
                    }
                } else {
                    throw new Error(data.message || 'Failed to load stats');
                }
            } catch (error) {
                console.error('Error loading video stats:', error);
                showErrorAlert('Erreur lors du chargement des statistiques');
            }
        }

        /**
         * Display video statistics in the dashboard
         */
        function displayVideoStats(stats) {
            const statsGrid = document.getElementById('statsGrid');
            
            statsGrid.innerHTML = `
                <div class="stat-card success">
                    <div class="stat-header">
                        <div class="stat-icon">üìä</div>
                    </div>
                    <div class="stat-number">${stats.total_submissions || 0}</div>
                    <div class="stat-label">Total Soumissions</div>
                </div>

                <div class="stat-card success">
                    <div class="stat-header">
                        <div class="stat-icon">‚úÖ</div>
                    </div>
                    <div class="stat-number">${stats.videos_present || 0}</div>
                    <div class="stat-label">Vid√©os Pr√©sentes</div>
                    <div class="stat-trend trend-up">
                        ${stats.video_completion_rate || 0}% compl√©t√©es
                    </div>
                </div>

                <div class="stat-card ${stats.videos_pending > 0 ? 'warning' : 'success'}">
                    <div class="stat-header">
                        <div class="stat-icon">‚è≥</div>
                    </div>
                    <div class="stat-number">${stats.videos_pending || 0}</div>
                    <div class="stat-label">En Attente</div>
                </div>

                <div class="stat-card ${stats.videos_missing > 0 ? 'danger' : 'success'}">
                    <div class="stat-header">
                        <div class="stat-icon">‚ùå</div>
                    </div>
                    <div class="stat-number">${stats.videos_missing || 0}</div>
                    <div class="stat-label">Manquantes</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">üíæ</div>
                    </div>
                    <div class="stat-number">${stats.total_storage_gb || 0}</div>
                    <div class="stat-label">GB Stockage</div>
                    <div class="stat-trend">
                        ${stats.total_storage_mb || 0} MB total
                    </div>
                </div>

                <div class="stat-card ${stats.critical_alerts > 0 ? 'danger' : 'success'}">
                    <div class="stat-header">
                        <div class="stat-icon">üö®</div>
                    </div>
                    <div class="stat-number">${stats.critical_alerts || 0}</div>
                    <div class="stat-label">Alertes Critiques</div>
                    <div class="stat-trend">
                        Commandes >48h sans vid√©o
                    </div>
                </div>
            `;
        }

        /**
         * Show critical alerts if any
         */
        function showCriticalAlerts(stats) {
            const alertsSection = document.getElementById('alertsSection');
            
            if (stats.critical_alerts > 0) {
                alertsSection.innerHTML = `
                    <div class="alert alert-danger">
                        <span style="font-size: 1.5rem;">üö®</span>
                        <div>
                            <strong>Attention !</strong> 
                            ${stats.critical_alerts} commande(s) sans vid√©o depuis plus de 48 heures.
                            <button class="btn btn-small btn-danger ml-2" onclick="filterOldSubmissions()">
                                Voir les commandes
                            </button>
                        </div>
                    </div>
                `;
            } else {
                alertsSection.innerHTML = '';
            }
        }

        /**
         * Load submissions with current filters and pagination
         */
        async function loadSubmissions(page = 1) {
            try {
                showLoading(true);
                
                // Build query parameters
                const params = new URLSearchParams({
                    page: page,
                    limit: 20,
                    ...currentFilters
                });

                const response = await fetch(`/admin/api/submissions?${params}`, {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    currentSubmissions = data.submissions;
                    currentPage = data.pagination.page;
                    totalPages = data.pagination.total_pages;
                    
                    displaySubmissions(data.submissions);
                    displayPagination(data.pagination);
                    updateResultsCount(data.pagination.total);
                    showLoading(false);
                } else {
                    throw new Error(data.message || 'Failed to load submissions');
                }
            } catch (error) {
                console.error('Error loading submissions:', error);
                showErrorAlert('Erreur lors du chargement des soumissions');
                showLoading(false);
            }
        }

        /**
         * Display submissions in the table
         */
        function displaySubmissions(submissions) {
            const tableContainer = document.getElementById('tableContainer');
            const emptyState = document.getElementById('emptyState');
            const tbody = document.getElementById('submissionsTable');

            if (submissions.length === 0) {
                tableContainer.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            tableContainer.style.display = 'block';

            tbody.innerHTML = submissions.map(submission => `
                <tr ${submission.needs_attention ? 'style="background-color: #fff3cd;"' : ''}>
                    <td>
                        <input type="checkbox" class="submission-checkbox" value="${submission.submission_id}">
                    </td>
                    <td>
                        <strong>${submission.submission_id}</strong>
                        ${submission.needs_attention ? '<span title="Attention requise" style="color: #dc3545;">‚ö†Ô∏è</span>' : ''}
                    </td>
                    <td>${submission.customer_email}</td>
                    <td>
                        <div>${submission.card_name || 'N/A'}</div>
                        <small class="text-muted">${submission.card_series || ''}</small>
                    </td>
                    <td>
                        <span class="badge badge-${submission.grading_type}">
                            ${getGradingTypeLabel(submission.grading_type)}
                        </span>
                    </td>
                    <td>
                        <span class="badge badge-${getVideoStatusClass(submission.video_status)}">
                            ${getVideoStatusLabel(submission.video_status)}
                        </span>
                        ${submission.days_without_video ? `<br><small class="text-muted">${submission.days_without_video} jours</small>` : ''}
                    </td>
                    <td>
                        ${submission.video_size_mb ? `${submission.video_size_mb} MB` : '-'}
                    </td>
                    <td>
                        <div>${formatDate(submission.created_at)}</div>
                        ${submission.recording_timestamp ? `<small class="text-muted">Vid√©o: ${formatDate(submission.recording_timestamp)}</small>` : ''}
                    </td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-small" onclick="viewSubmissionDetails('${submission.submission_id}')" title="Voir d√©tails">
                                üëÅÔ∏è
                            </button>
                            ${submission.video_status === 'uploaded' ? `
                                <button class="btn btn-small btn-primary" onclick="viewVideo('${submission.submission_id}')" title="Voir vid√©o">
                                    ‚ñ∂Ô∏è
                                </button>
                            ` : ''}
                            <button class="btn btn-small" onclick="regenerateQR('${submission.submission_id}')" title="R√©g√©n√©rer QR">
                                üîÑ
                            </button>
                            ${submission.video_status === 'uploaded' ? `
                                <button class="btn btn-small btn-danger" onclick="deleteVideo('${submission.submission_id}')" title="Supprimer vid√©o">
                                    üóëÔ∏è
                                </button>
                            ` : ''}
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        /**
         * Display pagination controls
         */
        function displayPagination(pagination) {
            const container = document.getElementById('paginationContainer');
            
            if (pagination.total_pages <= 1) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'flex';
            
            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `
                <button ${!pagination.has_prev ? 'disabled' : ''} 
                        onclick="loadSubmissions(${pagination.page - 1})">
                    ‚Üê Pr√©c√©dent
                </button>
            `;
            
            // Page numbers (simplified)
            const startPage = Math.max(1, pagination.page - 2);
            const endPage = Math.min(pagination.total_pages, pagination.page + 2);
            
            if (startPage > 1) {
                paginationHTML += `<button onclick="loadSubmissions(1)">1</button>`;
                if (startPage > 2) {
                    paginationHTML += `<span>...</span>`;
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <button class="${i === pagination.page ? 'active' : ''}" 
                            onclick="loadSubmissions(${i})">
                        ${i}
                    </button>
                `;
            }
            
            if (endPage < pagination.total_pages) {
                if (endPage < pagination.total_pages - 1) {
                    paginationHTML += `<span>...</span>`;
                }
                paginationHTML += `<button onclick="loadSubmissions(${pagination.total_pages})">${pagination.total_pages}</button>`;
            }
            
            // Next button
            paginationHTML += `
                <button ${!pagination.has_next ? 'disabled' : ''} 
                        onclick="loadSubmissions(${pagination.page + 1})">
                    Suivant ‚Üí
                </button>
            `;
            
            container.innerHTML = paginationHTML;
        }

        /**
         * Apply current filters and reload submissions
         */
        function applyFilters() {
            currentFilters = {
                search: document.getElementById('searchInput').value.trim(),
                video_status: document.getElementById('videoStatusFilter').value,
                grading_type: document.getElementById('gradingTypeFilter').value,
                date_from: document.getElementById('dateFromFilter').value,
                date_to: document.getElementById('dateToFilter').value
            };
            
            // Remove empty filters
            Object.keys(currentFilters).forEach(key => {
                if (!currentFilters[key]) {
                    delete currentFilters[key];
                }
            });
            
            currentPage = 1; // Reset to first page
            loadSubmissions(1);
        }

        /**
         * Debounced filter for search input
         */
        function debounceFilter() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                applyFilters();
            }, 500);
        }

        /**
         * Clear all filters
         */
        function clearAllFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('videoStatusFilter').value = '';
            document.getElementById('gradingTypeFilter').value = '';
            document.getElementById('dateFromFilter').value = '';
            document.getElementById('dateToFilter').value = '';
            
            currentFilters = {};
            currentPage = 1;
            loadSubmissions(1);
        }

        /**
         * Filter submissions older than 48h without video
         */
        function filterOldSubmissions() {
            document.getElementById('videoStatusFilter').value = 'missing';
            applyFilters();
        }

        /**
         * Update results count display
         */
        function updateResultsCount(total) {
            const counter = document.getElementById('resultsCount');
            counter.textContent = `${total} r√©sultat(s)`;
        }

        /**
         * View submission details in modal
         */
        async function viewSubmissionDetails(submissionId) {
            try {
                const response = await fetch(`/admin/api/submission/${submissionId}/details`, {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    showSubmissionModal(data.submission);
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                console.error('Error loading submission details:', error);
                showErrorAlert('Erreur lors du chargement des d√©tails');
            }
        }

        /**
         * Show submission details in modal
         */
        function showSubmissionModal(submission) {
            const modal = document.getElementById('submissionModal');
            const modalBody = document.getElementById('submissionModalBody');
            
            modalBody.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                    
                    <!-- Submission Info -->
                    <div class="content-section">
                        <h4 style="margin-bottom: 1rem; color: #003366;">üìã Informations Soumission</h4>
                        <div style="display: grid; gap: 0.5rem;">
                            <div><strong>ID:</strong> ${submission.submission_id}</div>
                            <div><strong>Client:</strong> ${submission.customer_email}</div>
                            <div><strong>Carte:</strong> ${submission.card_name}</div>
                            <div><strong>S√©rie:</strong> ${submission.card_series || 'N/A'}</div>
                            <div><strong>Type PSA:</strong> ${getGradingTypeLabel(submission.grading_type)}</div>
                            <div><strong>Prix:</strong> ${submission.price || 0}‚Ç¨</div>
                            <div><strong>Cr√©√©:</strong> ${formatDateTime(submission.created_at)}</div>
                            <div><strong>√Çge:</strong> ${submission.days_since_creation} jours</div>
                        </div>
                    </div>

                    <!-- Video Info -->
                    <div class="content-section">
                        <h4 style="margin-bottom: 1rem; color: #003366;">üé• Informations Vid√©o</h4>
                        <div style="display: grid; gap: 0.5rem;">
                            <div><strong>Statut:</strong> 
                                <span class="badge badge-${getVideoStatusClass(submission.video_status)}">
                                    ${getVideoStatusLabel(submission.video_status)}
                                </span>
                            </div>
                            ${submission.video_size_mb ? `<div><strong>Taille:</strong> ${submission.video_size_mb} MB</div>` : ''}
                            ${submission.video_duration ? `<div><strong>Dur√©e:</strong> ${Math.round(submission.video_duration)} sec</div>` : ''}
                            ${submission.recording_timestamp ? `<div><strong>Enregistr√©:</strong> ${formatDateTime(submission.recording_timestamp)}</div>` : ''}
                            <div><strong>QR Code:</strong> ${submission.has_qr_code ? '‚úÖ G√©n√©r√©' : '‚ùå Non g√©n√©r√©'}</div>
                            ${submission.qr_code_generated_at ? `<div><strong>QR g√©n√©r√©:</strong> ${formatDateTime(submission.qr_code_generated_at)}</div>` : ''}
                        </div>
                    </div>
                </div>

                ${submission.video_status === 'uploaded' && submission.video_access_url ? `
                    <div class="video-container">
                        <video class="video-player" controls>
                            <source src="${submission.video_access_url}" type="video/webm">
                            <source src="${submission.video_access_url}" type="video/mp4">
                            Votre navigateur ne supporte pas la lecture vid√©o.
                        </video>
                        <div class="video-info">
                            <div class="video-meta">
                                <div class="video-meta-label">Taille fichier</div>
                                <div class="video-meta-value">${submission.video_size_mb || 0} MB</div>
                            </div>
                            <div class="video-meta">
                                <div class="video-meta-label">Dur√©e</div>
                                <div class="video-meta-value">${submission.video_duration ? Math.round(submission.video_duration) + 's' : 'N/A'}</div>
                            </div>
                            <div class="video-meta">
                                <div class="video-meta-label">Format</div>
                                <div class="video-meta-value">WebM/MP4</div>
                            </div>
                            <div class="video-meta">
                                <div class="video-meta-label">Enregistr√©</div>
                                <div class="video-meta-value">${submission.recording_timestamp ? formatDateTime(submission.recording_timestamp) : 'N/A'}</div>
                            </div>
                        </div>
                    </div>
                ` : ''}

                <div style="display: flex; justify-content: center; gap: 1rem; margin-top: 2rem;">
                    ${submission.has_qr_code && submission.qr_code_url ? `
                        <a href="${submission.qr_code_url}" target="_blank" class="btn btn-primary">
                            üì± Voir QR Code
                        </a>
                    ` : ''}
                    ${submission.recording_url ? `
                        <a href="${submission.recording_url}" target="_blank" class="btn">
                            üîó Lien Enregistrement
                        </a>
                    ` : ''}
                    <button class="btn" onclick="regenerateQR('${submission.submission_id}')">
                        üîÑ R√©g√©n√©rer QR
                    </button>
                    ${submission.video_status === 'uploaded' ? `
                        <button class="btn btn-danger" onclick="deleteVideo('${submission.submission_id}')">
                            üóëÔ∏è Supprimer Vid√©o
                        </button>
                    ` : ''}
                </div>
            `;
            
            modal.style.display = 'block';
        }

        /**
         * Regenerate QR code for submission
         */
        async function regenerateQR(submissionId) {
            if (!confirm('√ätes-vous s√ªr de vouloir r√©g√©n√©rer le QR code ?')) {
                return;
            }

            try {
                const response = await fetch(`/admin/api/video/regenerate-qr/${submissionId}`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    showSuccessAlert('QR code r√©g√©n√©r√© avec succ√®s');
                    loadSubmissions(currentPage); // Refresh current page
                    
                    // CRITIQUE: Rafra√Æchir aussi la modal si elle est ouverte pour cette soumission
                    const openModal = document.getElementById('submissionModal');
                    if (openModal && openModal.style.display === 'block') {
                        // Recharger automatiquement les d√©tails de la soumission dans la modal
                        viewSubmissionDetails(submissionId);
                    }
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                console.error('Error regenerating QR:', error);
                showErrorAlert('Erreur lors de la r√©g√©n√©ration du QR code');
            }
        }

        /**
         * Delete video for submission
         */
        async function deleteVideo(submissionId) {
            if (!confirm('‚ö†Ô∏è ATTENTION ‚ö†Ô∏è\n\n√ätes-vous absolument s√ªr de vouloir supprimer cette vid√©o ?\n\nCette action est IRR√âVERSIBLE et supprimera d√©finitivement le fichier vid√©o.')) {
                return;
            }

            try {
                const response = await fetch(`/admin/api/video/delete/${submissionId}`, {
                    method: 'DELETE',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ confirm: true })
                });

                const data = await response.json();

                if (data.success) {
                    showSuccessAlert('Vid√©o supprim√©e avec succ√®s');
                    loadSubmissions(currentPage); // Refresh current page
                    closeSubmissionModal(); // Close modal if open
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                console.error('Error deleting video:', error);
                showErrorAlert('Erreur lors de la suppression de la vid√©o');
            }
        }

        /**
         * Show cleanup modal
         */
        function showCleanupModal() {
            document.getElementById('cleanupModal').style.display = 'block';
        }

        /**
         * Run system cleanup
         */
        async function runCleanup() {
            const cleanOrphans = document.getElementById('cleanOrphans').checked;
            const cleanOldFiles = document.getElementById('cleanOldFiles').checked;
            const daysThreshold = parseInt(document.getElementById('daysThreshold').value);
            const dryRun = document.getElementById('dryRun').checked;

            if (!cleanOrphans && !cleanOldFiles) {
                showErrorAlert('Veuillez s√©lectionner au moins une option de nettoyage');
                return;
            }

            if (!dryRun && !confirm('‚ö†Ô∏è ATTENTION ‚ö†Ô∏è\n\nVous allez effectuer un nettoyage R√âEL du syst√®me.\nCela supprimera d√©finitivement des fichiers.\n\n√ätes-vous absolument s√ªr ?')) {
                return;
            }

            try {
                const response = await fetch('/admin/api/video/cleanup', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        clean_orphans: cleanOrphans,
                        clean_old_files: cleanOldFiles,
                        days_threshold: daysThreshold,
                        dry_run: dryRun
                    })
                });

                const data = await response.json();

                if (data.success) {
                    displayCleanupResults(data);
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                console.error('Error running cleanup:', error);
                showErrorAlert('Erreur lors du nettoyage syst√®me');
            }
        }

        /**
         * Display cleanup results
         */
        function displayCleanupResults(data) {
            const resultsDiv = document.getElementById('cleanupResults');
            const results = data.cleanup_results;
            const summary = data.summary;

            resultsDiv.innerHTML = `
                <div class="content-section">
                    <h4>${data.dry_run ? 'üîç Simulation Nettoyage' : 'üßπ Nettoyage Effectu√©'}</h4>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1rem 0;">
                        <div class="stat-card">
                            <div class="stat-number">${summary.orphaned_files_count}</div>
                            <div class="stat-label">Fichiers orphelins</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${summary.old_files_count}</div>
                            <div class="stat-label">Anciens fichiers</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${summary.database_mismatches_count}</div>
                            <div class="stat-label">Incoh√©rences DB</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${summary.total_space_freed_mb}</div>
                            <div class="stat-label">MB lib√©r√©s</div>
                        </div>
                    </div>

                    ${summary.errors_count > 0 ? `
                        <div class="alert alert-warning">
                            <strong>‚ö†Ô∏è ${summary.errors_count} erreur(s) d√©tect√©e(s)</strong>
                            <details style="margin-top: 0.5rem;">
                                <summary>Voir les erreurs</summary>
                                <ul style="margin-top: 0.5rem;">
                                    ${results.errors.map(error => `<li>${error}</li>`).join('')}
                                </ul>
                            </details>
                        </div>
                    ` : ''}

                    ${!data.dry_run && summary.total_space_freed_mb > 0 ? `
                        <div class="alert alert-success">
                            ‚úÖ Nettoyage termin√© avec succ√®s ! ${summary.total_space_freed_mb} MB d'espace lib√©r√©.
                        </div>
                    ` : ''}
                </div>
            `;

            resultsDiv.style.display = 'block';
        }

        /**
         * Show system status modal
         */
        async function showSystemStatus() {
            try {
                const response = await fetch('/admin/api/video/system-status', {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    displaySystemStatus(data.system_status);
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                console.error('Error loading system status:', error);
                showErrorAlert('Erreur lors du chargement de l\'√©tat syst√®me');
            }
        }

        /**
         * Display system status in modal
         */
        function displaySystemStatus(status) {
            const modal = document.getElementById('systemStatusModal');
            const modalBody = document.getElementById('systemStatusBody');
            
            const healthColor = status.health_score >= 90 ? '#28a745' : 
                               status.health_score >= 70 ? '#ffa500' : '#dc3545';

            modalBody.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
                    
                    <!-- System Health -->
                    <div class="content-section">
                        <h4 style="color: #003366; margin-bottom: 1rem;">ü©∫ Sant√© Syst√®me</h4>
                        <div style="text-align: center; margin-bottom: 1rem;">
                            <div style="font-size: 3rem; font-weight: bold; color: ${healthColor};">
                                ${status.health_score}%
                            </div>
                            <div style="color: #666;">Score de sant√©</div>
                        </div>
                        <div style="display: grid; gap: 0.5rem;">
                            <div><strong>Derni√®re v√©rification:</strong><br>${formatDateTime(status.last_checked)}</div>
                        </div>
                    </div>

                    <!-- Storage Info -->
                    <div class="content-section">
                        <h4 style="color: #003366; margin-bottom: 1rem;">üíæ Stockage</h4>
                        <div style="display: grid; gap: 0.5rem;">
                            <div><strong>Total vid√©os:</strong> ${status.storage.total_videos}</div>
                            <div><strong>Espace utilis√©:</strong> ${status.storage.total_size_gb} GB</div>
                            <div><strong>Taille moyenne:</strong> ${status.storage.average_video_mb} MB</div>
                            <div><strong>Plus ancienne:</strong> ${status.storage.oldest_video ? formatDate(status.storage.oldest_video) : 'N/A'}</div>
                            <div><strong>Plus r√©cente:</strong> ${status.storage.newest_video ? formatDate(status.storage.newest_video) : 'N/A'}</div>
                        </div>
                    </div>

                    <!-- Integrity Checks -->
                    <div class="content-section">
                        <h4 style="color: #003366; margin-bottom: 1rem;">üîç Int√©grit√©</h4>
                        <div style="display: grid; gap: 0.5rem;">
                            <div><strong>Vid√©os sans QR:</strong> 
                                <span style="color: ${status.integrity.videos_without_qr > 0 ? '#dc3545' : '#28a745'};">
                                    ${status.integrity.videos_without_qr}
                                </span>
                            </div>
                            <div><strong>QR sans vid√©os:</strong> 
                                <span style="color: ${status.integrity.qr_without_videos > 0 ? '#dc3545' : '#28a745'};">
                                    ${status.integrity.qr_without_videos}
                                </span>
                            </div>
                            <div><strong>Fichiers manquants:</strong> 
                                <span style="color: ${status.integrity.missing_files > 0 ? '#dc3545' : '#28a745'};">
                                    ${status.integrity.missing_files}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn btn-primary" onclick="showCleanupModal(); closeSystemStatusModal();">
                        üßπ Lancer Maintenance
                    </button>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        /**
         * Export current submissions to CSV
         */
        async function exportToCSV() {
            try {
                // Get all submissions with current filters (no pagination)
                const params = new URLSearchParams({
                    limit: 10000, // Large limit to get all
                    ...currentFilters
                });

                const response = await fetch(`/admin/api/submissions?${params}`, {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    const csv = generateCSV(data.submissions);
                    downloadCSV(csv, 'psa-video-submissions.csv');
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                console.error('Error exporting CSV:', error);
                showErrorAlert('Erreur lors de l\'export CSV');
            }
        }

        /**
         * Generate CSV content from submissions
         */
        function generateCSV(submissions) {
            const headers = [
                'ID Soumission',
                'Client Email',
                'Carte',
                'S√©rie',
                'Type PSA',
                'Statut Vid√©o',
                'Taille Vid√©o (MB)',
                'Date Cr√©ation',
                'Date Enregistrement',
                'Jours Sans Vid√©o',
                'QR Code G√©n√©r√©'
            ];

            const rows = submissions.map(sub => [
                sub.submission_id,
                sub.customer_email,
                sub.card_name || '',
                sub.card_series || '',
                getGradingTypeLabel(sub.grading_type),
                getVideoStatusLabel(sub.video_status),
                sub.video_size_mb || '',
                formatDate(sub.created_at),
                sub.recording_timestamp ? formatDate(sub.recording_timestamp) : '',
                sub.days_without_video || '',
                sub.has_qr_code ? 'Oui' : 'Non'
            ]);

            const csvContent = [headers, ...rows]
                .map(row => row.map(field => `"${field}"`).join(','))
                .join('\\n');

            return csvContent;
        }

        /**
         * Download CSV file
         */
        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        /**
         * Refresh all data
         */
        async function refreshAllData() {
            await Promise.all([
                loadVideoStats(),
                loadSubmissions(currentPage)
            ]);
            showSuccessAlert('Donn√©es actualis√©es');
        }

        /**
         * Utility Functions
         */
        function getVideoStatusClass(status) {
            switch (status) {
                case 'uploaded': return 'uploaded';
                case 'pending': return 'pending';
                case null:
                case undefined: return 'missing';
                default: return 'error';
            }
        }

        function getVideoStatusLabel(status) {
            switch (status) {
                case 'uploaded': return '‚úÖ Pr√©sente';
                case 'pending': return '‚è≥ En attente';
                case null:
                case undefined: return '‚ùå Manquante';
                default: return '‚ö†Ô∏è Erreur';
            }
        }

        function getGradingTypeLabel(type) {
            switch (type) {
                case 'value': return 'PSA Value';
                case 'regular': return 'PSA Regular';
                case 'express': return 'PSA Express';
                default: return type || 'N/A';
            }
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            return new Date(dateString).toLocaleDateString('fr-FR');
        }

        function formatDateTime(dateString) {
            if (!dateString) return 'N/A';
            return new Date(dateString).toLocaleDateString('fr-FR') + ' ' + 
                   new Date(dateString).toLocaleTimeString('fr-FR', { 
                       hour: '2-digit', 
                       minute: '2-digit' 
                   });
        }

        function showLoading(show) {
            const loadingState = document.getElementById('loadingState');
            const tableContainer = document.getElementById('tableContainer');
            const paginationContainer = document.getElementById('paginationContainer');

            if (show) {
                loadingState.style.display = 'block';
                tableContainer.style.display = 'none';
                paginationContainer.style.display = 'none';
            } else {
                loadingState.style.display = 'none';
            }
        }

        function showErrorAlert(message) {
            // Simple alert for now - could be enhanced with toast notifications
            alert('‚ùå Erreur: ' + message);
        }

        function showSuccessAlert(message) {
            // Simple alert for now - could be enhanced with toast notifications
            alert('‚úÖ ' + message);
        }

        // Modal control functions
        function closeSubmissionModal() {
            document.getElementById('submissionModal').style.display = 'none';
        }

        function closeCleanupModal() {
            document.getElementById('cleanupModal').style.display = 'none';
            document.getElementById('cleanupResults').style.display = 'none';
        }

        function closeSystemStatusModal() {
            document.getElementById('systemStatusModal').style.display = 'none';
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = ['submissionModal', 'cleanupModal', 'systemStatusModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Escape to close modals
            if (event.key === 'Escape') {
                closeSubmissionModal();
                closeCleanupModal();
                closeSystemStatusModal();
            }
            
            // Ctrl+R to refresh
            if (event.ctrlKey && event.key === 'r') {
                event.preventDefault();
                refreshAllData();
            }
        });

        // Toggle select all checkboxes
        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.submission-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        }
    </script>
</body>
</html>